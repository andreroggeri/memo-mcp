# Research: Memo API Client Protobuf Generation

## Decisions

### 1. Code Generation Tooling
- **Decision**: Use `ts-proto` as the primary generation tool.
- **Rationale**: `ts-proto` generates clean, idiomatic TypeScript code. It supports generating a full client with a REST/JSON transport layer, which aligns with our requirement (FR-006). It also handles Protobuf service definitions and creates easy-to-use interfaces.
- **Alternatives considered**: 
    - `protoc-gen-ts`: More focused on gRPC and often requires additional dependencies for standard HTTP transport.
    - `buf`: Excellent for managing protos, but `ts-proto` is more direct for the specific TypeScript output we need in this project.

### 2. Transport Layer Implementation
- **Decision**: Implement the transport layer by creating a custom `Rpc` interface adapter using `axios`.
- **Rationale**: Memos uses gRPC-Gateway to expose its gRPC services over REST/JSON. By implementing the `Rpc` interface generated by `ts-proto`, we can use the generated `MemoServiceClientImpl` class, ensuring that we never have to manually write service method logic (like URL construction or parameter mapping).
- **Alternatives considered**: 
    - Manual Wrapper: Rejected as it duplicates logic that can be generated.
    - Native gRPC: Rejected due to complexity of environment setup and lack of immediate need for binary streaming/multiplexing.

### 3. Upstream Proto Fetching
- **Decision**: Create a manual script (`scripts/fetch-protos.sh`) that uses `curl` to download `memo_service.proto` and its direct dependencies (like `api/v1/client_service.proto` if needed) from the `usememos/memos` GitHub repository.
- **Rationale**: Minimalist approach that avoids git submodules. Manual execution (for now) gives the developer control over when updates happen.
- **Alternatives considered**: 
    - Git Submodule: Too heavy for just a few proto files.
    - Automated CI fetching: Better deferred until the project has a more mature CI pipeline.

### 4. Project Structure
- **Decision**: Use `src/gen/` for all generated code and `scripts/` for the fetch/generation logic.
- **Rationale**: Keeps the codebase clean by separating generated artifacts from handwritten logic (FR-008).
